<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ward-wise Voter Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --primary:#4361ee;
  --bg:#f4f6fb;
}
body{
  font-family:Segoe UI, sans-serif;
  background:var(--bg);
  margin:0;
  padding:20px;
}
.container{
  max-width:850px;
  margin:auto;
  background:#fff;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  overflow:hidden;
}
.header{
  background:var(--primary);
  color:#fff;
  padding:20px;
  text-align:center;
  position:relative;
}
.lang-toggle{
  position:absolute;
  right:20px;
  top:20px;
  background:rgba(255,255,255,.2);
  color:#fff;
  border:none;
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
}
.content{padding:25px}
label{font-weight:600;display:block;margin-top:15px}
select,button,input{
  padding:10px;
  font-size:15px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:5px;
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
}
.info-box{
  background:#eef4ff;
  padding:12px;
  border-left:4px solid var(--primary);
  margin-top:15px;
  border-radius:8px;
}
.result{
  margin-top:20px;
  display:none;
}
.voter-list{
  background:#fff;
  padding:10px;
  border-radius:8px;
  max-height:250px;
  overflow:auto;
  border:1px solid #ddd;
}
.chart-box{
  max-width:350px;
  margin:20px auto;
  display:none;
}
.hidden{display:none}
</style>
</head>

<body>

<!-- ðŸ” PASSWORD PAGE -->
<div class="container" id="loginBox">
  <div class="header">
    <h2>Secure Login</h2>
  </div>
  <div class="content" style="text-align:center">
    <input type="password" id="password" placeholder="Enter Password">
    <br><br>
    <button onclick="checkPassword()">Login</button>
  </div>
</div>

<!-- ðŸ”“ MAIN APP -->
<div class="container hidden" id="mainApp">
  <div class="header">
    <h2 id="title">Ward-wise Voter Analysis</h2>
    <button class="lang-toggle" id="langToggle">à¤¹à¤¿à¤‚à¤¦à¥€</button>
  </div>

  <div class="content">

    <label id="lblWard">Select Ward</label>
    <select id="wardSelect">
      <option value="">-- Select Ward --</option>
    </select>

    <div class="info-box hidden" id="wardInfo">
      <p><b id="houseLbl">Total Houses:</b> <span id="houseCount"></span></p>
      <p><b id="voterLbl">Total Voters:</b> <span id="wardVoters"></span></p>
    </div>

    <div class="chart-box" id="chartBox">
      <canvas id="pieChart"></canvas>
    </div>

    <label id="lblHouse">Select House</label>
    <select id="houseSelect" disabled></select>

    <div class="info-box hidden" id="houseInfo">
      <b id="houseSummary"></b>
    </div>

    <button onclick="showVoters()" id="btnText">
      <i class="fa fa-users"></i> Show Voters
    </button>

    <div class="result" id="result">
      <h3 id="resultHeader"></h3>
      <p><b id="totalLbl">Total Voters:</b> <span id="totalVoters"></span></p>
      <div class="voter-list" id="voterList"></div>
    </div>

  </div>
</div>

<script>
let allData=[],currentLang='en',chart=null;

const texts={
en:{
 title:"Ward-wise Voter Analysis",
 lblWard:"Select Ward",
 lblHouse:"Select House",
 btn:"Show Voters",
 houses:"Total Houses:",
 voters:"Total Voters:",
 total:"Total Voters:"
},
hi:{
 title:"à¤µà¤¾à¤°à¥à¤¡-à¤µà¤¾à¤° à¤®à¤¤à¤¦à¤¾à¤¤à¤¾ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",
 lblWard:"à¤µà¤¾à¤°à¥à¤¡ à¤šà¥à¤¨à¥‡à¤‚",
 lblHouse:"à¤®à¤•à¤¾à¤¨ à¤šà¥à¤¨à¥‡à¤‚",
 btn:"à¤®à¤¤à¤¦à¤¾à¤¤à¤¾ à¤¦à¥‡à¤–à¥‡à¤‚",
 houses:"à¤•à¥à¤² à¤®à¤•à¤¾à¤¨:",
 voters:"à¤•à¥à¤² à¤®à¤¤à¤¦à¤¾à¤¤à¤¾:",
 total:"à¤•à¥à¤² à¤®à¤¤à¤¦à¤¾à¤¤à¤¾:"
}
};

/* PASSWORD */
function checkPassword(){
  if(password.value==="1857"){
    loginBox.classList.add('hidden');
    mainApp.classList.remove('hidden');
  } else alert("Wrong Password");
}

/* LOAD DATA */
fetch('voters.json')
.then(r=>r.json())
.then(d=>{
  allData=d;
  [...new Set(d.map(v=>v.Ward))].sort((a,b)=>a-b)
  .forEach(w=>wardSelect.innerHTML+=`<option>${w}</option>`);
});

/* LANGUAGE */
langToggle.onclick=()=>{
  currentLang=currentLang==='en'?'hi':'en';
  langToggle.textContent=currentLang==='en'?'à¤¹à¤¿à¤‚à¤¦à¥€':'English';
  updateLang();
};
function updateLang(){
  let t=texts[currentLang];
  title.textContent=t.title;
  lblWard.textContent=t.lblWard;
  lblHouse.textContent=t.lblHouse;
  btnText.textContent=t.btn;
  houseLbl.textContent=t.houses;
  voterLbl.textContent=t.voters;
  totalLbl.textContent=t.total;
}
updateLang();

/* WARD CHANGE */
wardSelect.onchange=()=>{
  let w=+wardSelect.value;
  if(!w) return;

  let wd=allData.filter(v=>v.Ward===w);
  let houses=[...new Set(wd.map(v=>v.H_No))];

  houseCount.textContent=houses.length;
  wardVoters.textContent=wd.length;
  wardInfo.classList.remove('hidden');

  houseSelect.innerHTML='<option value="">-- Select House --</option>';
  houses.forEach(h=>houseSelect.innerHTML+=`<option>${h}</option>`);
  houseSelect.disabled=false;

  drawChart(wd);
};

/* PIE CHART */
function drawChart(data){
  let map={};
  data.forEach(v=>map[v.H_No]=(map[v.H_No]||0)+1);

  if(chart) chart.destroy();
  chart=new Chart(pieChart,{
    type:'pie',
    data:{
      labels:Object.keys(map),
      datasets:[{data:Object.values(map)}]
    },
    options:{plugins:{legend:{position:'bottom'}}}
  });
  chartBox.style.display='block';
}

/* HOUSE CHANGE */
houseSelect.onchange=()=>{
  let w=+wardSelect.value,h=houseSelect.value;
  let cnt=allData.filter(v=>v.Ward===w && String(v.H_No)===String(h)).length;
  houseSummary.textContent=`House ${h} â†’ ${cnt} voters`;
  houseInfo.classList.remove('hidden');
};

/* SHOW VOTERS */
function showVoters(){
  let w=+wardSelect.value,h=houseSelect.value;
  let voters=allData.filter(v=>v.Ward===w && String(v.H_No)===String(h));

  resultHeader.textContent=`Ward ${w}, House ${h}`;
  totalVoters.textContent=voters.length;
  voterList.innerHTML='';

  voters.forEach((v,i)=>{
    let name=currentLang==='hi'
      ?(v.Name_hi||v.Name||'à¤¨à¤¾à¤® à¤¨à¤¹à¥€à¤‚')
      :(v.Name_en||v.Name||'Name NA');
    voterList.innerHTML+=`${i+1}. ${name}<br>`;
  });
  result.style.display='block';
}
</script>

</body>
</html>
